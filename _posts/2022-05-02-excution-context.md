---
title: 💡 실행 컨텍스트, 누구냐 넌...
categories: Javascript
tags: [javascript]
excerpt: Javascript 엔진은 Javascript 코드를 실행시키기 위해 특수한 환경을 만드는데 이 환경이 바로 실행 컨텍스트!
---

# 1. 실행 컨텍스트

## 1.1🤔 실행 컨텍스트란 무엇일까?

Javascript 엔진은 Javascript <u>코드를 실행시키기 위해 필요한 정보를 수집하여 특수한 환경을 만드는데</u> 이 환경이 바로 **실행 컨텍스트(Excution Context/ EC)**이다.  
간단히 말하면 실행 컨텍스트는 **실행할 코드에 제공할 환경 정보들을 모아놓은 객체** 라고 할 수 있다.  

다음과 같은 코드를 살펴보자.  

```js
var name = "홍길동";

function foo() {
  var age = "20";
  console.log(name + "," + age);
}

foo();
```

위 코드에서 `foo()`라는 함수를 실행시키려면 전역변수 `name`과, 지역변수 `age`, 그리고 `foo()`함수의 scope 등의 정보들이 필요하다.  
바로 이 정보들을 담고 있는 객체가 바로 실행 컨텍스트이다!  

## 1.2 코드를 실행하기 위해 필요한 정보란 무엇일까?

실행 컨텍스트는 코드를 실행하기 위해 다음과 같은 정보들을 담고 있다.  

- 변수 : 전역변수, 지역변수, 매개변수, 객체의 프로퍼티
- scope(변수의 유효 범위)
- this

## 1.3 실행 컨텍스트와 Call Stack

실행 컨텍스트가 콜 스택에 쌓이는 과정을 자세히 알아보기 위해 참고한 이미지 및 코드의 출처는 다음과 같다.  
https://poiemaweb.com/js-execution-context  

```js
var x = "xxx";

function foo() {
  var y = "yyy";

  function bar() {
    var z = "zzz";
    console.log(x + y + z);
  }
  bar();
}
foo();
```

위 코드를 실행하면 아래의 이미지처럼 **콜 스택(call stack)**에 컨텍스트가 생성되고 소멸한다.  

![실행 컨텍스트 스택 동작 과정](https://poiemaweb.com/img/ec_1.png)  

동작 과정에서 단계를 설명하면  

1. 자바스크립트 코드를 실행하는 순간 <u>전역 실행 컨텍스트</u>가 생성되고 콜 스택에 쌓인다.
   (전역 실행 컨텍스트는 애플리케이션이 종료될 때(웹 페이지에서 나가거나 브라우저를 닫을 때)까지 유지된다.)  
2. 함수를 호출하면 <u>해당 함수의 실행 컨텍스트가 생성</u>되고 콜 스택에 쌓인다.
3. 함수가 실행 종료되면 해당 함수의 <u>실행 컨텍스트는 제거</u>되고 제어권이 직전 실행 컨텍스트로 전달된다.

# 2. 실행 컨텍스트 Deep Dive 🏊‍♂️

💡 실행 컨텍스트에 대한 기본적인 이해가 되었다면 좀 더 자세하게 알아보자.  

## 2.1 실행 컨텍스트의 종류에는 어떤 것이 있을까?

ECMAScript는 소스 코드를 4가지 type으로 분류하는데 4가지의 타입은 다음과 같다.  

- 전역 코드(Global code) : 전역 영역에 존재하는 코드
- 함수 코드(Function code) : 함수 내에 존재하는 코드가
- Eval 코드(Eval code) : eval 함수로 실행되는 코드
- 모듈 코드(Module code) : 모듈 내부에 존재하는 코드(ES6+)

위의 4가지의 타입에 따라 실행 컨텍스트도 각각 다르게 생성되며, 각각 Global Excution Context(GEC), Function Excution Context(FEC), Eval Excution Context, Module Excution Context가 생성된다.  

### 전역 실행 컨텍스트

`전역 실행 컨텍스트(Global Execution Context)`는 함수 내부에 존재하지 않는 모든 코드가 실행되는 컨텍스트로, 모든 Javascript 파일에는 전역 실행 컨텍스트가 오직 한 개만 존재한다.  

### 함수 실행 컨텍스트

`함수 실행 컨텍스트(Function Execution Context)`는 함수가 실행될 때마다 해당 함수에 대한 실행 컨텍스트가 만들어지며, 함수의 모든 동작이 종료되면 소멸된다.  

### Eval 함수 실행 컨텍스트

`eval()` 함수는 문자열을 코드로 인식하게 만드는 함수로 엄격 모드(strict mode)에서 독립적인 스코프를 생성한다. eval 함수 사용 시에도 그에 따른 실행 컨텍스트가 생성되며, [사용 시 해커에 의해 위험하게 사용될 수 있어 절대 사용하지 말 것을 권장하고 있다](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/eval)  

```js
eval("1+1"); //4
```

### Module 실행 컨텍스트

`모듈 실행 컨텍스트(Module Execution Context)`는 모듈 별로 독립적인 스코프를 가지기 때문에 모듈마다 모듈 컨텍스트가 생성된다.  

실행 컨텍스트는 총 4가지 존재하지만 아래부터 다뤄지는 실행 컨텍스트의 자세한 내용들은 전역 실행 컨텍스트와 함수 실행 컨텍스트에 대해서만 다루었다.  

## 2.2 실행 컨텍스트의 생성

실행 컨텍스트는 생성과 실행 두 단계로 동작이 이루어지는데, 먼저 실행 컨텍스트의 생성 단계는 총 3단계로 구분되며 각 단계를 통해 생성된 `변수 객체`, `스코프 체인`, `this`는 실행 컨텍스트 객체의 프로퍼티가 된다.  

1. 변수 객체 생성
2. scope chain 생성
3. this 값 설정

### 생성 단계 : 변수 객체 생성

변수 객체(Variable Object / VO)는 `변수`, `매개변수(parameter)`, `인수(arguments)`, `함수 선언(함수 표현식 제외)`과 같은 정보들을 담는 객체이다.  

> \* **함수 선언식**과 **함수 표현식**의 차이는 <u>함수 선언은 이름이 할당된 함수</u>이고 <u>함수 표현식은 익명 함수</u>를 말한다. 함수 표현식은 일반적으로 변수에 함수를 할당하는 것과 같은 명령문에서 사용된다.
> 함수 선언식과 표현식 각각의 예를 들면 `function foo(){}`는 함수 선언식이고 `let foo = function()`은 함수 표현식이다.

변수 객체는 실행 컨텍스트의 프로퍼티이기 때문에 어떠한 값을 가리키고 있는데, <u>전역 실행 컨텍스트와 함수 실행 컨텍스트가 가리키는 값이 각각 다르다.</u>  

- 전역 실행 컨텍스트 : 전역 변수, 전역 함수 등을 포함하는 **전역 객체(Global Object/ GO)** 를 가리킨다.
- 함수 실행 컨텍스트 : **활성 객체(Activation Object / AO)**를 가리키며 매개변수와 인수들의 정보를 담고 있는 arguments object를 담고 있다.

또한 전역 실행 컨텍스트에서 변수 객체가 생성될 때 다음과 같은 작업이 이루어지며 이것을 바로 **호이스팅** 이라고 한다.  

- 전역 실행 컨텍스트에서 `var` 키워드로 선언된 변수들이 변수 객체(VO)에 추가되고 `undefined`로 초기화된다.
- 모든 함수 선언에 대해 해당 함수를 가리키는 속성이 변수 객체에 추가되고 해당 속성은 메모리에 저장된다.

### 생성 단계 : Scope Chain 생성

Javascript에서 **scope**는 코드에 액세스할 수 있는 범위를 말하며 각각의 함수 실행 컨텍스트는 scope를 생성한다. `스코프 체인(Scope Chain / SC)`은 이 scope 내에 있는 변수, 함수 선언 등의 정보들을 담고 있는 객체의 리스트를 가리킨다.  
다시 말해, 전역과 함수 실행 컨텍스트가 가리키는 리스트는 다음과 같다.  

- 전역 실행 컨텍스트 : 전역 scope에서 참조할 수 있는 변수, 함수 선언 등의 정보를 담은 전역 객체(GO)의 리스트를 가리킨다.
- 함수 실행 컨텍스트 : 함수 scope에서 참조할 수 있는 변수, 함수 선언 등의 정보를 담고 있는 활성 객체(AO)의 리스트를 가리킨다.

스코프 체인의 구조를 살펴보면 다음과 같다.  

![스코프 체인 구조](https://poiemaweb.com/img/ec-sc.png)  
🏞 이미지 출처 : [https://poiemaweb.com/js-execution-context](https://poiemaweb.com/js-execution-context)  

위의 이미지처럼 스코프체인은 현재 실행 컨텍스트의 활성 객체를 시작으로 하위로 갈수록 상위 컨텍스트의 활성 객체를 가리키며, 마지막 리스트는 전역 객체를 가리킨다.  

또한 Javascript 엔진은 스코프 체인을 통해서 **렉시컬 스코프(Lexical Scope)**를 파악한다. 파악 과정은 다음과 같다.  

1. 함수 실행 중에 변수를 만나면 해당 변수를 우선 현재 scope인 활성 객체에서 검색해본다.
2. 검색에 실패하면 스코프 체인을 따라 순서대로 검색을 이어나간다.

> \* 렉시컬 스코프 : 함수를 어디서 호출하는지가 아니라 어디에 선언하였는지에 따라 결정되는 스코프

### 생성 단계 : this value

Javascript에서 `this`는 실행 컨텍스트가 속한 범위를 나타내는 것으로 스코프 체인이 생성되면 `this` 값이 초기화된다.  
또한 this는 전역 실행 컨텍스트와 함수 실행 컨텍스트에서 각각 값이 다르다.  

- 전역 실행 컨텍스트 : this는 전역 객체인 `window`를 가리킨다.
- 함수 실행 컨텍스트 : this를 생성하지 않고 정의된 환경에 따라 다른 객체를 가리킨다.

## 2.3 실행 컨텍스트의 실행

실행 컨텍스트의 생성 단계 다음은 실행 단계이며, 이 단계에서 실제 코드 실행이 시작된다.  
이 시점까지 변수 객체(VO)의 변수들은 `undefined`로 초기화되어 있으며, 이 단계에서 Javascript 엔진은 현재 실행 컨텍스트의 코드를 한 번 더 읽은 다음 변수의 실제 값으로 변수 객체(VO)를 업데이트 한다. 그런 다음 코드는 파서에 의해 구문 분석되고 실행 가능한 바이트 코드로 전송되어 최종적으로 실행된다.  

### Javascript 실행 스택(=콜 스택)

`실행 스택(=콜 스택, 호출 스택)`은 Javascript의 수명주기 동안 생성된 모든 실행 컨텍스트를 추적한다.  
Javascript는 단일 스레드 언어이지만 여러 개의 작업을 처리하기 위해서 다음 작업에 대한 실행 컨텍스트를 실행 스택에 쌓아 둔다.  
스택은 LIFO(Last In First Out) 구조이기 때문에 실행 컨텍스트는 위로 쌓이게 되고 가장 먼저 생성된 전역 실행 컨텍스트는 가장 아래에 배치되게 된다.  

```js
var x = "xxx";

function foo() {
  var y = "yyy";

  function bar() {
    var z = "zzz";
    console.log(x + y + z);
  }
  bar();
}
foo();
```

위의 코드를 실행하는 과정에서의 실행 스택 변화를 살펴보면  

1. Javascript 엔진에 의해 코드가 로드된다.
2. **전역 실행 컨텍스트(GEC)**가 생성되고 실행 스택에 쌓인다.
3. `foo()` 함수 호출 코드를 만나면 `foo()` 함수에 대한 새로운 **함수 실행 컨텍스트(FEC)**가 생성되어 현재 실행 컨텍스트 위에 쌓인다.
   - `foo()` 함수가 실행되는 동안은 해당 실행 컨텍스트가 활성 컨텍스트가 된다.
   - `foo()` 함수 내부의 변수 `y`는 함수 실행 컨텍스트에 저장된다.
4. `foo()` 함수 내부에서 `bar()` 함수가 호출되면, Javascript의 단일 스레드 특성으로 인해 함수 실행이 중지되고 `bar()`함수가 실행되며,
   `bar()` 함수에 대한 새로운 **함수 실행 컨텍스트(FEC)**가 생성되어 스택에 쌓이고 활성 컨텍스트가 된다.  
5. `bar()` 함수가 모두 수행되면 해당 함수 실행 컨텍스트는 스택에서 제거되고 `foo()` 함수의 실행 컨텍스트가 활성 컨텍스트가 된다.
6. `foo()` 함수 역시 같은 과정을 거쳐 스택에서 제거되고 전역 실행 컨텍스트가 활성 컨텍스트가 된다.
7. 전체 코드의 실행이 완료되면 전역 실행 컨텍스트가 제거된다.

# 정리

- 실행 컨텍스트는 **코드가 실행되기 위해 필요한 정보들을 담고있는 객체**이다.
- 코드가 실행되기 위해 필요한 정보로는 this, scope, 변수 등이 있다.
- 실행 컨텍스트에는 전역 실행 컨텍스트, 함수 실행 컨텍스트 등이 있다.
- 실행 컨텍스트가 생성되는 과정에서 **호이스팅**이 일어나며 **this 및 Lexical Scope가 결정**된다.
- 실행 컨텍스트는 실행 스택(콜 스택)에 쌓이고 함수 실행 컨텍스트의 경우 함수 실행이 완료되면 제거된다.

# ✍️

호이스팅, scope 등에 대한 개념들을 실행 컨텍스트를 알아보면서 마주하게 되어 반가운 느낌이 들었다.✨ 알고 있던 개념들이었기 때문일 수도 있지만 실행 컨텍스트의 개념과 생성, 실행 과정에 대해 알아보고 난 이후라서 그런지 그 개념들에 대해 좀 더 잘 이해할 수 있었다.  
실행 컨텍스트가 내용이 방대하고 추상적인 느낌이 있어 깊게 알아보는 것이 주저되었지만💦 이렇게 정리해보고 나니 Javascript의 동작 원리를 좀 더 이해할 수 있게 된 것 같아 뿌듯한 느낌이 든다.  
정리하는 과정에서 모든 내용을 담기에는 나의 이해도 부족하고 내용이 길어질 것 같아 첫 포스팅은 최대한 핵심 내용으로 정리해보았지만 다음에는 더 주제를 축소해서 자세하게 알아보는 시간을 가져야겠다.🤔  

> 📖 참고  
> [JavaScript Execution Context – How JS Works Behind The Scenes](https://www.freecodecamp.org/news/execution-context-how-javascript-works-behind-the-scenes/) > [실행 컨텍스트와 자바스크립트의 동작 원리](https://poiemaweb.com/js-execution-context)  
> [Javascript] 실행 컨텍스트 (Execution Context) 와 소스코드](https://haeunyah.tistory.com/96)
